<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern TV Player with AdBlock Detection</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
body, html { margin:0; padding:0; height:100%; font-family:'Roboto', sans-serif; background:#121212; color:#fff; }
#main { display:flex; flex-direction:column; height:100vh; }
#player { width:100%; flex-grow:1; background:#000; }
#controls { padding:15px; display:flex; justify-content:center; gap:15px; background:#1e1e1e; }
.btn { padding:12px; font-size:1.2em; }
#playlist { position:fixed; top:0; right:0; width:300px; height:100%; background:#1e1e1e; overflow-y:auto; transform:translateX(300px); transition:transform 0.3s; z-index:5; }
body.playlist-open #playlist { transform:translateX(0); }
#playlist h3 { margin:20px 0 10px; font-size:1.2em; color:#bbb; padding:10px 0; background:#1e1e1e; position:sticky; top:0; z-index:1; }
#playlist ul { list-style:none; padding:0; margin:0; }
#playlist li { display:flex; align-items:center; padding:12px; cursor:pointer; border-radius:8px; margin-bottom:8px; transition:all 0.3s; }
#playlist li:hover { background:#333; transform:translateX(5px); }
#playlist li.active { background:#282828; font-weight:bold; box-shadow:0 0 10px #ff4081; }
#playlist img { width:50px; height:50px; object-fit:contain; margin-right:15px; border-radius:8px; }
#toggle-menu { position:fixed; top:20px; left:20px; z-index:10; background:rgba(0,0,0,0.7); border:none; border-radius:50%; width:50px; height:50px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:24px; color:#fff; }
#ST1mar { display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(255,255,255,0.58); z-index:99999; justify-content:center; align-items:center; }
.at-adblock-content-wrapper { background:#fff; max-width:400px; border-radius:10px; box-shadow:0 0 24px rgba(0,0,0,0.4); width:100%; padding:30px 50px; text-align:center; }
.at-adblock-content-wrapper h3 { font-size:25px; margin-top:1rem; color:#b23939; font-weight:700; }
.at-adblock-content-wrapper p { font-size:13px; font-weight:500; margin:20px 0; color:#000; }
.ad-btn { width:100%; padding:10px 20px; border-radius:30px; border:none; background:#b23939; color:#fff; cursor:pointer; transition:0.2s; }
.ad-btn:hover { background:#fff; color:#b23939; border:2px solid #b23939; }
@media(max-width:480px){ .at-adblock-content-wrapper{max-width:300px} .at-adblock-content-wrapper h3{font-size:20px} .at-adblock-content-wrapper p{font-size:12px} .ad-btn{font-size:12px} #playlist{width:100%; transform:translateX(100%);} body.playlist-open #playlist{transform:translateX(0);} }
</style>
</head>
<body>
<!-- AdBlock Popup -->
<div class='ADs-BG center hidden' id='ST1mar'>
  <div class='at-adblock-content-wrapper'>
    <h3>Attention! Ad blocker Detected!</h3>
    <p>We know ads are annoying but please disable your ad blocker!</p>
    <button class='ad-btn' id='adBtn'>Okay</button>
  </div>
</div>

<!-- Main Player -->
<div id="mainContent">
  <div id="main">
    <video id="player" controls autoplay playsinline></video>
    <div id="controls">
      <button id="prev" class="btn btn-primary"><i class="fas fa-backward"></i></button>
      <button id="mute" class="btn btn-secondary"><i class="fas fa-volume-up"></i></button>
      <button id="next" class="btn btn-primary"><i class="fas fa-forward"></i></button>
    </div>
    <div id="playlist"></div>
    <button id="toggle-menu" class="btn"><i class="fas fa-bars"></i></button>
  </div>
</div>

<script>
const playlistUrl = 'https://raw.githubusercontent.com/dxluminant/tv_channel/main/channels.m3u';
let tracks=[], groups={}, currentTrack=0;
const video=document.getElementById('player');
const playlistEl=document.getElementById('playlist');
const prevBtn=document.getElementById('prev');
const nextBtn=document.getElementById('next');
const toggleMenu=document.getElementById('toggle-menu');

toggleMenu.addEventListener('click',()=>document.body.classList.toggle('playlist-open'));
prevBtn.addEventListener('click',()=>{ currentTrack=(currentTrack-1+tracks.length)%tracks.length; loadTrack(currentTrack); });
nextBtn.addEventListener('click',()=>{ currentTrack=(currentTrack+1)%tracks.length; loadTrack(currentTrack); });

function parseM3U(content){
  const lines=content.split('\n'); let extinf='';
  for(let line of lines){ line=line.trim();
    if(!line||line.startsWith('#EXTM3U')) continue;
    if(line.startsWith('#EXTINF:')){ extinf=line.substring(8).trim(); } 
    else if(!line.startsWith('#')){
      if(extinf){ const track=parseExtinf(extinf,line); tracks.push(track); extinf=''; }
    }
  }
}

function parseExtinf(extinf,url){
  const commaIndex=extinf.lastIndexOf(',');
  let title='Unknown Channel', attrStr=extinf;
  if(commaIndex!==-1){ title=extinf.substring(commaIndex+1).trim(); attrStr=extinf.substring(0,commaIndex).trim(); }
  const attrs={}, matches=attrStr.matchAll(/([a-z-]+)="([^"]*)"/g);
  for(const match of matches){ attrs[match[1]]=match[2]; }
  return { url, title: attrs['tvg-name']||title, logo:attrs['tvg-logo'], group:attrs['group-title'], duration:-1 };
}

function groupTracks(){ groups={}; tracks.forEach((track,index)=>{ const g=track.group||'Other'; if(!groups[g]) groups[g]=[]; groups[g].push({...track,index}); }); }

function renderPlaylist(){
  playlistEl.innerHTML='';
  Object.keys(groups).sort().forEach(group=>{
    const h3=document.createElement('h3'); h3.textContent=group; playlistEl.appendChild(h3);
    const ul=document.createElement('ul');
    groups[group].forEach(track=>{
      const li=document.createElement('li');
      if(track.logo){ const img=document.createElement('img'); img.src=track.logo; li.appendChild(img); }
      const span=document.createElement('span'); span.textContent=track.title; li.appendChild(span);
      li.addEventListener('click',()=>{ currentTrack=track.index; loadTrack(currentTrack); document.body.classList.remove('playlist-open'); });
      ul.appendChild(li);
    });
    playlistEl.appendChild(ul);
  });
  updateActiveTrack();
}

function loadTrack(i){
  if(i<0||i>=tracks.length) return;
  if(Hls.isSupported()&&tracks[i].url.endsWith('.m3u8')){ const hls=new Hls(); hls.loadSource(tracks[i].url); hls.attachMedia(video); } 
  else { video.src=tracks[i].url; }
  video.load(); video.play().catch(err=>console.error(err)); updateActiveTrack();
}

function updateActiveTrack(){
  const items=playlistEl.querySelectorAll('li'); items.forEach(item=>item.classList.remove('active'));
  if(items[currentTrack]) items[currentTrack].classList.add('active');
}

// AdBlock Detection
function detectAdBlock(callback){
  let bait=document.createElement('div'); bait.className='adsbox'; bait.style.width='1px'; bait.style.height='1px'; bait.style.position='absolute'; bait.style.left='-9999px';
  document.body.appendChild(bait);
  setTimeout(()=>{ const blocked=(bait.offsetParent===null||window.getComputedStyle(bait).display==='none'); document.body.removeChild(bait); callback(blocked); },50);
}

detectAdBlock(blocked=>{
  const popup=document.getElementById('ST1mar');
  const btn=document.getElementById('adBtn');
  if(blocked){ popup.style.display='flex'; } 
  else { loadPlaylist(); document.getElementById('mainContent').style.display='block'; }
  btn.addEventListener('click',()=>{ popup.style.display='none'; loadPlaylist(); document.getElementById('mainContent').style.display='block'; });
});

async function loadPlaylist(){
  const res=await fetch(playlistUrl); const text=await res.text(); parseM3U(text); groupTracks(); renderPlaylist(); loadTrack(currentTrack);
}
</script>
</body>
</html>