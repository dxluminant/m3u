<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Modern TV Player</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    :root {
      --primary-color: #2196f3;
      --background-color: #121212;
      --surface-color: #1e1e1e;
      --text-color: #ffffff;
      --text-secondary: #bbbbbb;
      --accent-color: #ff4081;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }
    #main { display: flex; flex-direction: column; height: 100vh; position: relative; }
    #player { width: 100%; flex-grow: 1; background-color: #000; }
    #controls { padding: 15px; background: linear-gradient(to bottom, var(--surface-color), #181818);
      display: flex; justify-content: center; gap: 15px; }
    .btn { transition: all 0.3s ease; padding: 12px; font-size: 1.2em; }
    .btn:hover { transform: translateY(-2px); }
    #playlist { position: fixed; top: 0; right: 0; width: 300px; height: 100%; background-color: var(--surface-color);
      overflow-y: auto; padding: 20px; transform: translateX(300px); transition: transform 0.3s ease-in-out; }
    body.playlist-open #playlist { transform: translateX(0); }
    #playlist h3 { margin: 20px 0 10px; font-size: 1.2em; color: var(--text-secondary); }
    #playlist li { display: flex; align-items: center; padding: 12px; cursor: pointer; border-radius: 8px; }
    #playlist li.active { background-color: #282828; font-weight: bold; }
    #playlist img { width: 50px; height: 50px; object-fit: contain; margin-right: 15px; }
    #status { position: absolute; bottom: 80px; left: 20px; background: rgba(0,0,0,0.8);
      padding: 10px 20px; border-radius: 25px; font-size: 0.9em; display: none; }
    #toggle-menu { position: fixed; top: 20px; left: 20px; background: rgba(0,0,0,0.7); border-radius: 50%;
      width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 24px; }
    #loader { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      border: 5px solid #f3f3f3; border-top: 5px solid var(--primary-color); border-radius: 50%;
      width: 40px; height: 40px; animation: spin 1s linear infinite; display: none; }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); } }
    /* Ad container styles */
    .ad-container { display: flex; justify-content: center; padding: 10px 0; background-color: var(--surface-color); }
    .ad-container iframe { display: block; margin: 0 auto; }
  </style>
</head>
<body>
  <div id="main">
    <video id="player" controls autoplay playsinline></video>
    <!-- Ad Unit 1: 468x60 (Above Controls) -->
    <div class="ad-container">
      <script type="text/javascript">
        atOptions = {
          'key' : '0e4c12e19122f03ae09be7e4194b5eca',
          'format' : 'iframe',
          'height' : 60,
          'width' : 468,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/0e4c12e19122f03ae09be7e4194b5eca/invoke.js"></script>
    </div>
    <div id="controls">
      <button id="prev" class="btn btn-primary"><i class="fas fa-backward"></i></button>
      <button id="mute" class="btn btn-secondary"><i class="fas fa-volume-up"></i></button>
      <button id="next" class="btn btn-primary"><i class="fas fa-forward"></i></button>
    </div>
    <!-- Ad Unit 2: 728x90 (Below Controls) -->
    <div class="ad-container">
      <script type="text/javascript">
        atOptions = {
          'key' : 'ed71ec8b2651bc3c13696cb28a68f16d',
          'format' : 'iframe',
          'height' : 90,
          'width' : 728,
          'params' : {}
        };
      </script>
      <script type="text/javascript" src="//www.highperformanceformat.com/ed71ec8b2651bc3c13696cb28a68f16d/invoke.js"></script>
    </div>
    <div id="loader"></div>
  </div>
  <div id="playlist">
<script type='text/javascript' src='//pl27725593.revenuecpmgate.com/a1/8f/58/a18f585648f8cea38bc78896a3132c2b.js'></script></div>
  <div id="status">Loading...</div>
  <button id="toggle-menu" class="btn"><i class="fas fa-bars"></i></button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const originalPlaylistUrl = 'https://raw.githubusercontent.com/dxluminant/tv_channel/main/channels.m3u';
    const playlistUrl = `/api/proxy?url=${encodeURIComponent(originalPlaylistUrl)}`;

    let tracks = [];
    let groups = {};
    let currentTrack = 0;
    const video = document.getElementById('player');
    const playlistEl = document.getElementById('playlist');
    const statusEl = document.getElementById('status');
    const prevBtn = document.getElementById('prev');
    const muteBtn = document.getElementById('mute');
    const nextBtn = document.getElementById('next');
    const toggleMenu = document.getElementById('toggle-menu');
    const loader = document.getElementById('loader');
    let hls;

    toggleMenu.addEventListener('click', () => {
      document.body.classList.toggle('playlist-open');
    });

    muteBtn.addEventListener('click', () => {
      video.muted = !video.muted;
      const icon = muteBtn.querySelector('i');
      if (video.muted) { icon.classList.replace('fa-volume-up', 'fa-volume-mute'); }
      else { icon.classList.replace('fa-volume-mute', 'fa-volume-up'); }
    });

    async function loadPlaylist() {
      statusEl.textContent = 'Loading playlist...';
      statusEl.style.display = 'block';
      loader.style.display = 'block';
      try {
        const response = await fetch(playlistUrl);
        if (!response.ok) throw new Error('Failed to fetch playlist');
        const text = await response.text();
        parseM3U(text);
        groupTracks();
        renderPlaylist();
        loadTrack(currentTrack);
      } catch (error) {
        statusEl.textContent = `Error: ${error.message}`;
      } finally {
        loader.style.display = 'none';
      }
    }

    function parseM3U(content) {
      const lines = content.split('\n');
      let extinf = '';
      for (let line of lines) {
        line = line.trim();
        if (!line || line.startsWith('#EXTM3U')) continue;
        if (line.startsWith('#EXTINF:')) {
          extinf = line.substring(8).trim();
        } else if (!line.startsWith('#')) {
          if (extinf) {
            const track = parseExtinf(extinf, line);
            tracks.push(track);
            extinf = '';
          }
        }
      }
    }

    function parseExtinf(extinf, url) {
      const commaIndex = extinf.lastIndexOf(',');
      let title = 'Unknown Channel';
      let attrStr = extinf;
      if (commaIndex !== -1) {
        title = extinf.substring(commaIndex + 1).trim();
        attrStr = extinf.substring(0, commaIndex).trim();
      }
      const attrs = {};
      const matches = attrStr.matchAll(/([a-z-]+)="([^"]*)"/g);
      for (const match of matches) {
        attrs[match[1]] = match[2];
      }
      return {
        url,
        title: attrs['tvg-name'] || title,
        logo: attrs['tvg-logo'],
        group: attrs['group-title']
      };
    }

    function groupTracks() {
      groups = {};
      tracks.forEach((track, index) => {
        const g = track.group || 'Other';
        if (!groups[g]) groups[g] = [];
        groups[g].push({ ...track, index });
      });
    }

    function renderPlaylist() {
      playlistEl.innerHTML = '';
      Object.keys(groups).sort().forEach(group => {
        const h3 = document.createElement('h3');
        h3.textContent = group;
        playlistEl.appendChild(h3);

        const ul = document.createElement('ul');
        groups[group].forEach(track => {
          const li = document.createElement('li');
          if (track.logo) {
            const img = document.createElement('img');
            img.src = track.logo;
            li.appendChild(img);
          }
          const span = document.createElement('span');
          span.textContent = track.title;
          li.appendChild(span);
          li.addEventListener('click', () => {
            currentTrack = track.index;
            loadTrack(currentTrack);
            document.body.classList.remove('playlist-open');
          });
          ul.appendChild(li);
        });
        playlistEl.appendChild(ul);
      });
      updateActiveTrack();
    }

    function loadTrack(index) {
      if (index < 0 || index >= tracks.length) return;
      const url = tracks[index].url;
      if (hls) hls.destroy();
      if (Hls.isSupported() && url.endsWith('.m3u8')) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
      } else {
        video.src = url;
      }
      video.play().catch(() => {});
      updateActiveTrack();
      statusEl.textContent = `Playing: ${tracks[index].title}`;
      statusEl.style.display = 'block';
      setTimeout(() => { statusEl.style.display = 'none'; }, 2000);
    }

    function updateActiveTrack() {
      const items = playlistEl.querySelectorAll('li');
      items.forEach(item => item.classList.remove('active'));
      const activeLi = [...items].find(li => {
        const span = li.querySelector('span');
        return span && tracks[currentTrack].title === span.textContent;
      });
      if (activeLi) activeLi.classList.add('active');
    }

    prevBtn.addEventListener('click', () => {
      currentTrack = (currentTrack - 1 + tracks.length) % tracks.length;
      loadTrack(currentTrack);
    });
    nextBtn.addEventListener('click', () => {
      currentTrack = (currentTrack + 1) % tracks.length;
      loadTrack(currentTrack);
    });

    loadPlaylist();
  </script>
</body>
</html>